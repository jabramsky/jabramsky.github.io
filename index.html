<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>dummy1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.7.3/d3.min.js"></script>
    <style>
    html, body, #vis {
        height: 100%;
        margin: 0;
    }

    .tooltip {
        position: absolute;
    }

    .tooltip p {
        background-color: white;
        border: #eee 1px solid;
        padding: 2px;
        font-family: sans-serif;
        font-size: 11px;
    }
</style>
</head>
<body>
    <div id="vis">

    </div>
    <script>

    var width = 1800;
    var height = 1000;

    var margin = {
        top: 10,
        bottom: 100,
        left: 100,
        right: 120
    };

    var svg = d3.select('#vis')
        .append('svg')
            .attr('width', width)
            .attr('height', height)
        .append('g')
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

    var tooltip = d3.select('body')
        .append('div')
        .attr('class', 'tooltip');

    width = width - margin.left - margin.right;
    height = height - margin.top - margin.bottom;

    

    d3.csv('industry_gva_and_supply_small.csv', function(csv_data){
        console.log(csv_data);

        var x_scale = d3.scaleLinear()
        .range([0, width]);

        
        var output = d3.max(csv_data, function(d){
            return (+d.OUTPUT);
        })

        x_scale.domain([0, output]);

        var x_axis = d3.axisBottom()
            .scale(x_scale);

        var ic = d3.max(csv_data, function(d){
            return (+d.IC);
        })

        var gva = d3.max(csv_data, function(d){
            return (+d.GVA);
        })

        var coe = d3.max(csv_data, function(d){
            return (+d.COE);
        })

        var gos = d3.max(csv_data, function(d){
            return (+d.GOS);
        })

        var ts = d3.max(csv_data, function(d){
            return (+d.T_S);
        })



        var ic_scaled = x_scale(ic)
        var gva_scaled = x_scale(gva)
        var coe_scaled = x_scale(coe)
        var gos_scaled = x_scale(gos)
        var ts_scaled = x_scale(ts)

        var ic_rect = svg.selectAll('.ic_rect')
            .data([csv_data]);

        var gvap_rect = svg.selectAll('.gvap_rect')
            .data([csv_data]);

        var output_rect = svg.selectAll('.output_rect')
            .data([csv_data]);

        var coe_rect = svg.selectAll('.coe_rect')
            .data([csv_data]);

        var gos_rect = svg.selectAll('.gos_rect')
            .data([csv_data]);

        var ts_rect = svg.selectAll('.ts_rect')
            .data([csv_data]);

        ic_rect
                .enter()
                .append('rect')
                .attr('class','ic_rect')
                .attr("fill", "red")
                .attr('width', ic_scaled)
                .attr('height', 100)
                .attr('y', 290) 
                .attr('x', 0)

        gvap_rect
                .enter()
                .append('rect')
                .attr('class','gvap_rect')
                .attr("fill", "black")
                .attr('width', gva_scaled)
                .attr('height', 100)
                .attr('y', 440) 
                .attr('x', ic_scaled)

        output_rect
                .enter()
                .append('rect')
                .attr('class','output_rect')
                .attr("fill", "green")
                .attr('width', width)
                .attr('height', 100)
                .attr('y', 140) 
                .attr('x', 0)

        coe_rect
                .enter()
                .append('rect')
                .attr('class','coe_rect')
                .attr("fill", "blue")
                .attr('width', coe_scaled)
                .attr('height', 100)
                .attr('y', 590) 
                .attr('x', ic_scaled)

        gos_rect
                .enter()
                .append('rect')
                .attr('class','gos_rect')
                .attr("fill", "black")
                .attr('width', gos_scaled)
                .attr('height', 100)
                .attr('y', 590) 
                .attr('x', ic_scaled + coe_scaled)

        ts_rect
                .enter()
                .append('rect')
                .attr('class','ts_rect')
                .attr("fill", "red")
                .attr('width', ts_scaled)
                .attr('height', 100)
                .attr('y', 590) 
                .attr('x', ic_scaled + coe_scaled + gos_scaled)


        var ic_text_name = svg.selectAll('ic_text_name')
            .data([csv_data])
            
        ic_text_name
                    .enter()
                    .append('text')
                    .attr('class', 'ic_text_name')
                    .attr('x', ic_scaled - 220)
                    .attr('y', 312)
                    .text('Intermediate consumption:')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var ic_text_label = svg.selectAll('ic_text_label')
            .data([csv_data])
            
        ic_text_label
                    .enter()
                    .append('text')
                    .attr('class', 'ic_text_label')
                    .attr('x', ic_scaled - 220)
                    .attr('y', 332)
                    .text('£' + ic + 'm')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var output_text_name = svg.selectAll('output_text_name')
            .data([csv_data])

        output_text_name
                    .enter()
                    .append('text')
                    .attr('class', 'output_text_name')
                    .attr('x', width - 90)
                    .attr('y', 162)
                    .text('Output:')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var output_text_label = svg.selectAll('output_text_label')
            .data([csv_data])
            
        output_text_label
                    .enter()
                    .append('text')
                    .attr('class', 'output_text_label')
                    .attr('x', width - 90)
                    .attr('y', 182)
                    .text('£' + output + 'm')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var gvap_text_name = svg.selectAll('gvap_text_name')
            .data([csv_data])

        gvap_text_name
                    .enter()
                    .append('text')
                    .attr('class', 'gvap_text_name')
                    .attr('x', width - 85)
                    .attr('y', 462)
                    .text('GVA:')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var gvap_text_label = svg.selectAll('gvap_text_label')
            .data([csv_data])
            
        gvap_text_label
                    .enter()
                    .append('text')
                    .attr('class', 'gvap_text_label')
                    .attr('x', width - 85)
                    .attr('y', 482)
                    .text('£' + gva + 'm')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var coe_text_name = svg.selectAll('coe_text_name')
            .data([csv_data])

        coe_text_name
                    .enter()
                    .append('text')
                    .attr('class', 'coe_text_name')
                    .attr('x', ic_scaled + coe_scaled - 85)
                    .attr('y', 632)
                    .text('COE:')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var coe_text_label = svg.selectAll('coe_text_label')
            .data([csv_data])
            
        coe_text_label
                    .enter()
                    .append('text')
                    .attr('class', 'coe_text_label')
                    .attr('x', ic_scaled + coe_scaled - 85)
                    .attr('y', 652)
                    .text('£' + coe + 'm')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var gos_text_name = svg.selectAll('gos_text_name')
            .data([csv_data])

        gos_text_name
                    .enter()
                    .append('text')
                    .attr('class', 'gos_text_name')
                    .attr('x', width - 85)
                    .attr('y', 632)
                    .text('GOS:')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var gos_text_label = svg.selectAll('gos_text_label')
            .data([csv_data])
            
        gos_text_label
                    .enter()
                    .append('text')
                    .attr('class', 'gos_text_label')
                    .attr('x', ic_scaled + coe_scaled + gos_scaled - 85)
                    .attr('y', 652)
                    .text('£' + gos + 'm')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");


        ts_text_name
                    .enter()
                    .append('text')
                    .attr('class', 'ts_text_name')
                    .attr('x', width - 85)
                    .attr('y', 632)
                    .text('Net taxes (D.29):')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");

        var ts_text_label = svg.selectAll('ts_text_label')
            .data([csv_data])
            
        ts_text_label
                    .enter()
                    .append('text')
                    .attr('class', 'ts_text_label')
                    .attr('x', width - 85)
                    .attr('y', 652)
                    .text('£' + ts + 'm')
                    .attr("font-family", "serif")
                    .attr("font-size", "20px")
                    .attr("fill", "white");
        

        var line1 = svg.selectAll('line1')
            .data([csv_data])


        var line2 = svg.selectAll('line2')
            .data([csv_data])

        line1
            .enter()  
            .append('line')
            .attr('class','line1')
            .attr('x1', (ic_scaled + 2))
            .attr('y1', (240))
            .attr('x2', (ic_scaled + 2))
            .attr('y2', (590))
            .attr("stroke-width", 2)
            .attr("stroke", "black");


        line2  
            .enter()
            .append('line')
            .attr('class','line2')
            .attr('x1', (width - 2))
            .attr('y1', (240))
            .attr('x2', (width - 2))
            .attr('y2', (590))
            .attr("stroke-width", 2)
            .attr("stroke", "black");

        })

    </script>

</body>
</html>
