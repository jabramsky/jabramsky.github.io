<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="d3.min.js"></script>
    <script src="colorbrewer.js"></script>
    <style>
        html, body, #vis {
            height: 100%;
            margin: 0;
        }
    </style>
</head>
<body>
    <div id="vis">

    </div>

    <script>

        var width = document.getElementById('vis').clientWidth;
        var height = document.getElementById('vis').clientHeight;

        var margin = {
            top: 10,
            bottom: 70,
            left: 70,
            right: 20
        }

        var svg = d3.select('#vis')
            .append('svg')
                .attr('width', width)
                .attr('height', height)
            .append('g')
                .attr('transform', 'translate('+ margin.left + ',' + margin.right +')');

        width = width - margin.left - margin.right;
        height = height - margin.top - margin.bottom;

        var x_scale = d3.scaleBand()
            .rangeRound([0, width])
            .padding(0.1);

        var y_scale = d3.scaleLinear()
            .range([height, 0]);

        var colour_scale = d3.scaleQuantile()
            .range(colorbrewer.OrRd[9]);

        var y_axis = d3.axisLeft(y_scale);
        var x_axis = d3.axisBottom(x_scale);

        svg.append('g')
            .attr('class', 'x axis')
            .attr('transform', 'translate(0,' + height + ')');

        svg.append('g')
            .attr('class', 'y axis');

        d3.csv('monthly_data_2014.csv', function(csv_data){
            console.log(csv_data);

            var months = csv_data.map(function(d){ return d.month; });
            console.log(months);
            x_scale.domain(months);

            var max_value = d3.max(csv_data, function(d){ return +d.value; });

            y_scale.domain([0, max_value]);
            colour_scale.domain([0, max_value]);

            var bars = svg.selectAll('.bar')
                .data(csv_data)

            bars
                .exit()
                .remove();

            var new_bars = bars
                .enter()
                .append('rect')
                .attr('class', 'bar')

            new_bars.merge(bars)
                .attr('x', function(d){ return x_scale(d.month); })
                .attr('width', x_scale.bandwidth())
                .attr('y', function(d){ return y_scale(+d.value); })
                .attr('height', function(d){ return height - y_scale(+d.value)})
                .attr('fill', function(d){ return colour_scale(+d.value); })

            svg.select('.x.axis')
                .call(x_axis);

            svg.select('.y.axis')
                .call(y_axis);

        });

    </script>

</body>
</html>