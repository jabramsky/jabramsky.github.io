<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CMT212 Lab Week 4</title>
    <script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <style>
        .labels {
            fill: white;
        }
    </style>
</head>
<body>
    <div id="vis">
    </div>
    <script>

        var width = 500;
        var height = 500;

        var margin = {
            top: 20,
            left: 30,
            right: 30,
            bottom: 30
        };

        var svg = d3.select("#vis")
            .append("svg")
                .attr('width', width)
                .attr('height', height)
            .append("g")
                .attr("transform", "translate(" + margin.top + "," + margin.left + ")");

        width = width - margin.left - margin.right;
        height = height - margin.top - margin.bottom;

        var yscale = d3.scaleLinear()
                        .range([height, 0])
                        .domain([0, 1]);

        var xscale = d3.scaleBand()
                        .range([0, width])
                        .padding(0.1);

        var duration = 1000;

        var xaxis = d3.axisBottom(xscale);

        var yaxis = d3.axisLeft(yscale);

        svg.append('g')
            .attr('transform', 'translate(0, ' + (height) + ')')
            .attr('class', 'x axis');

        svg.append('g')
            .attr('class', 'y axis');

        d3.csv('prodfunction.csv', function(data){

            x_scale.domain(d3.extent(data, function(d){ return +d.NUMBER; }));
            y_scale.domain(d3.extent(data, function(d){ return +d.WAGESHARE; }));

            var bars = svg.selectAll('.bar')
                            .data(data);

            //exit
            bars
                .exit()
                .remove();

            // enter
            var new_bars = bars
                .enter()
                .append('rect')
                .attr('class','bar')
                .attr("fill", "red")
                .attr('width', xscale.bandwidth())
                .attr('height', 0)
                .attr('y', height)

            // update
            new_bars.merge(bars)
                .transition()
                .duration(duration)
                .attr("height", function(d){ return height - yscale(d.WAGESHARE); })
                .attr("y", function(d){ return yscale(d.WAGESHARE); })
                .attr("width", xscale.bandwidth())
                .attr("x", function(d){ return xscale(d.NUMBER); })

            // exit
            bars
                .exit()
                .transition()
                .duration(duration)
                .attr('height', 0)
                .attr('y', height)
                .remove();
            });
    </script>
</body>
</html>
