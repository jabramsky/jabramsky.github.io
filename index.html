<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Week 7 Lab</title>
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="//d3js.org/colorbrewer.v1.js"></script>
    <style>
        html, body, #vis {
            margin: 0;
            height: 100%;
            font-family: sans-serif;
        }

    </style>
</head>
<body>
    <div id="vis"></div>
    <script>

        var width = document.getElementById("vis").clientWidth;
        var height = document.getElementById("vis").clientHeight;

        var margin = {
            top: 50,
            bottom: 100,
            left: 100,
            right: 50
        };

        var svg = d3.select('#vis')
                    .append('svg')
                        .attr('height', height)
                        .attr('width', width)
                    .append('g')
                        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

        width = width - margin.left - margin.right;
        height = height - margin.top - margin.bottom;

        var x_scale = d3.scaleLinear()
                    .rangeRound([0, width]);

        var y_scale = d3.scaleLinear()
                    .rangeRound([height, 0])
                    .domain([0,1]);

        var colour_scale_ran = d3.scaleQuantile()
                    .range(colorbrewer.Reds[9]);

        var colour_scale_noran = d3.scaleQuantile()
                    .range(colorbrewer.Blues[9]);

        var area_scale = d3.scaleLinear()
                    .range([0, 400]);

        var y_axis = d3.axisLeft(y_scale);

        var x_axis = d3.axisBottom(x_scale);

        svg.append("g")
          .attr("class", "y axis");

        svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")");

        refyear = 1997

        function update(){
        d3.csv('timeseries_manuf_nototals.csv', function(full_data){

            data = full_data.filter(function(d){return +d.DATE === refyear})

            x_scale.domain(d3.extent(data, function(d){ return +d.INDUSTRY; }));
            area_scale.domain(d3.extent(data, function(d){ return +d.GVA; }));

            var manuf_colour = "black"
            var other_colour = "white"
            var dots = svg.selectAll('.dot')
                            .data(data);

            //exit
            dots
                .exit()
                .remove();

            // enter
            var new_dots = dots
                .enter()
                .append('circle')
                .attr('class', 'dot')
                .attr('stroke', 'black')
                .attr('stroke-width', '0.5px')

            //update
            new_dots.merge(dots)
                .attr('cx', function(d){ return x_scale(+d.INDUSTRY); })
                .attr('cy', function(d){ return y_scale(+d.WAGESHARE); })
                .attr('fill', function(d){
                    if(+d.MANUFACTURING === 1) {
                        return manuf_colour;
                    } else {
                        return other_colour;
                    }
                 })
                .attr('r', function(d){
                    var area = area_scale(+d.GVA);
                    var radius = Math.sqrt(area / Math.PI);
                    return radius;
                });


        d3.select('.x.axis')
            .call(x_axis);

        d3.select('.y.axis')
            .call(y_axis);

        svg.append("text")
              .attr("transform", "translate(" + width/2 +  "," + (height + margin.bottom/2) + ")")
              .style("text-anchor", "end")
              .text("Industry");

        svg.append("text")
          .attr("transform", "translate(-60," + height/2 + ")rotate(-90)")
          .style("text-anchor", "middle")
          .text("Wage Share");



        });

    }

    update();
    </script>

</body>
</html>
